{% extends 'base-admin.html' %}

{% block title %}Chỉnh sửa lớp học{% endblock %}

{% block content %}
<style>
    .custom-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #5c6bc0;
        border-bottom: 2px solid;
        margin: 1.5rem 0 1rem;
        padding: 8px 0;
    }
    .form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
    }
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-control {
        height: 50px;
        border-radius: 8px;
    }
    .btn-danger {
        background-color: #d32f2f;
        border: none;
    }
    .btn-dark {
        background-color: #000;
        border: none;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
</style>

<div class="container-fluid tab-section">
    <h2 class="custom-title">
        <a href="{% url 'class_list' %}" class="text-decoration-none text-primary">Danh sách lớp học</a> > Lớp {{ class_instance.class_name }}
    </h2>

    <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
            <a class="nav-link active" href="{% url 'class_detail' class_id=class_instance.pk %}">Mô tả lớp học</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'class_exercise' class_id=class_instance.pk %}">Bài tập</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'class_rollcall' class_id=class_instance.pk %}">Điểm danh</a>
        </li>
    </ul>

    <!-- Form cập nhật mô tả lớp học -->
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="update_class">

        <div class="form-group">
            <label class="form-label">Tên lớp học</label>
            {{ class_form.class_name }}
        </div>

        <div class="form-group">
            <label class="form-label">Tên khóa học</label>
            {{ class_form.course }}
        </div>

        <div class="form-group">
            <label class="form-label">Ngày bắt đầu</label>
            {{ class_form.begin_time }}
        </div>

        <div class="form-group">
            <label class="form-label">Ngày kết thúc</label>
            {{ class_form.end_time }}
        </div>

        <div class="form-group">
            <label class="form-label">Trạng thái lớp học</label>
            {{ class_form.status }}
        </div>

        <div class="form-group">
            <label class="form-label">Thời khóa biểu</label>
            {{ class_form.timetable }}
        </div>

        <div class="text-end mt-4">
            <button type="submit" class="btn btn-danger me-2">Lưu thay đổi</button>
            <a href="{% url 'class_list' %}" class="btn btn-dark">Hủy</a>
        </div>
    </form>

    <hr>

    <!-- Danh sách buổi học (Table with editable dates) -->
    <h3>Danh sách buổi học</h3>
    {% if lesson_details %}
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_lesson_dates">
            {{ lesson_detail_formset.management_form }}
            <table>
                <thead>
                    <tr>
                        <th>Tên buổi học</th>
                        <th>Số buổi</th>
                        <th>Ngày học</th>
                    </tr>
                </thead>
                <tbody>
                    {% for form in lesson_detail_formset %}
                        {% for lesson_detail in lesson_details %}
                            {% if forloop.counter0 == forloop.parentloop.counter0 %}
                                <tr>
                                    <td>{{ lesson_detail.lesson.lesson_name }}</td>
                                    <td>{{ lesson_detail.session_number }}</td>
                                    <td>
                                        {{ form.date }}
                                        {% if form.date.errors %}
                                            <div class="text-danger">{{ form.date.errors }}</div>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
            {% if lesson_detail_formset.non_form_errors %}
                <div class="text-danger">{{ lesson_detail_formset.non_form_errors }}</div>
            {% endif %}
            <div class="text-end mt-4">
                <button type="submit" class="btn btn-danger">Lưu ngày học</button>
            </div>
        </form>
    {% else %}
        <p>Chưa có buổi học nào</p>
    {% endif %}

    <hr>

    <!-- Form thêm buổi học -->
    <h3>Thêm Buổi Học</h3>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="add_lesson">

        <div class="form-group mb-3">
            <label for="id_lesson_name" class="form-label">Tên buổi học</label>
            {{ lesson_form.lesson_name }}
            {% if lesson_form.lesson_name.errors %}
                <div class="text-danger">{{ lesson_form.lesson_name.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group mb-3">
            <label for="id_session_number" class="form-label">Số buổi học</label>
            {{ lesson_form.session_number }}
            {% if lesson_form.session_number.errors %}
                <div class="text-danger">{{ lesson_form.session_number.errors }}</div>
            {% endif %}
        </div>



        <div class="text-end mt-4">
            <button type="submit" class="btn btn-danger me-2">Thêm Buổi Học</button>
        </div>
    </form>
</div>
{% endblock %}