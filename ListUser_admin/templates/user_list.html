{% extends 'base-admin.html' %}
{% load static %}
{% block styles %}
<style>
    /* Thiết lập chung */
body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f5f7fa;
  color: #333;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.page-title {
  font-size: 28px;
  font-weight: 600;
  margin-bottom: 24px;
  color: #333;
}

/* Phần tìm kiếm và nút thêm */
.search-add-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.search-container {
  position: relative;
  width: 50%;
}

.search-input {
  width: 100%;
  padding: 10px 15px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  outline: none;
}

.search-button {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  cursor: pointer;
}

.search-icon {
  color: #666;
}

.add-button {
  background-color: #e53935;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: background-color 0.2s;
}

.add-button:hover {
  background-color: #c62828;
}

/* Bảng dữ liệu */
.table-container {
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.user-table {
  width: 100%;
  border-collapse: collapse;
}

.user-table th {
  background-color: #f0f5ff;
  padding: 12px 16px;
  text-align: left;
  font-weight: 600;
  color: #333;
  border-bottom: 1px solid #e0e0e0;
}

.user-table td {
  padding: 12px 16px;
  border-bottom: 1px solid #e0e0e0;
}

.user-table tr:last-child td {
  border-bottom: none;
}

.user-table tr:hover {
  background-color: #f9f9f9;
}

/* Vai trò */
.role {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
}

.role-student {
  background-color: #e3f2fd;
  color: #1976d2;
}

.role-teacher {
  background-color: #e8f5e9;
  color: #388e3c;
}

.role-user {
  background-color: #fff3e0;
  color: #f57c00;
}

/* Nút hành động */
.actions {
  display: flex;
  margin-right:-15vh;
}

.action-button {
  padding: 6px 12px;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: background-color 0.2s;
}

.view-button {
  background-color: #2196f3;
  color: white;
}

.view-button:hover {
  background-color: #1976d2;
}

.edit-button {
  background-color: #ffc107;
  color: #333;
}

.edit-button:hover {
  background-color: #ffb300;
}

.delete-button {
  background-color: #f44336;
  color: white;
}

.delete-button:hover {
  background-color: #e53935;
}

/* Responsive */
@media (max-width: 768px) {
  .search-add-container {
    flex-direction: column;
    gap: 10px;
  }

  .search-container {
    width: 100%;
  }

  .user-table {
    font-size: 14px;
  }

  .actions {
    flex-direction: column;
    gap: 5px;
  }
}

</style>
{% endblock %}
{% block title %}Danh sách người dùng{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">Danh sách người dùng</h1>
    
    <div class="search-add-container">
        <div class="search-container">
            <form method="GET" action="{% url 'user_list' %}">
                <input type="text" name="search" placeholder="Nhập tên người dùng cần tìm kiếm" class="search-input" value="{{ search_query }}">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </form>
        </div>
        <a href="{% url 'user_create' %}" class="btn btn-primary">Thêm</a>
    </div>
    
    <div class="table-container">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Họ và tên</th>
                    <th>Vai trò</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ user.first_name }} {{ user.last_name }}</td>
                    <td>
                        {% if user.account.role == 'student' %}
                            <span class="role role-student">Học viên</span>
                        {% elif user.account.role == 'teacher' %}
                            <span class="role role-teacher">Giáo viên</span>
                        {% else %}
                            <span class="role role-user">Admin</span>
                        {% endif %}
                    </td>
                    <td class="actions">
                        <div class="dropdown">
                            <div class="dropdown-content">
                                <a href="{% url 'user_detail' user.user_id %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Xem
                                </a>
                                <a href="{% url 'user_edit' user.user_id %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                    Sửa
                                </a>
                                <a href="#" class="delete-action" data-user-id="{{ user.user_id }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                    </svg>
                                    Xóa
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">Không có người dùng nào</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Form ẩn để xóa người dùng -->
<form id="delete-form" method="POST" style="display: none;">
    {% csrf_token %}
</form>

<script>
    // Dropdown functionality
    document.addEventListener('click', function(e) {
        const dropdowns = document.querySelectorAll('.dropdown-content');
        if (!e.target.matches('.dropdown-btn') && !e.target.closest('.dropdown-btn')) {
            dropdowns.forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        } else {
            const dropdown = e.target.closest('.dropdown').querySelector('.dropdown-content');
            dropdowns.forEach(d => {
                if (d !== dropdown) d.classList.remove('show');
            });
            dropdown.classList.toggle('show');
        }
    });

    // Delete action
    document.querySelectorAll('.delete-action').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const userId = this.getAttribute('data-user-id');
            if (confirm('Bạn có chắc chắn muốn xóa người dùng này?')) {
                const form = document.getElementById('delete-form');
                form.action = `/users/${userId}/delete/`;
                form.submit();
            }
        });
    });
</script>
{% endblock %}

