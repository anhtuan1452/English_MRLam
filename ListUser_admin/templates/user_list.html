{% extends 'base-admin.html' %}
{% load static %}
{% block styles %}
<link rel="stylesheet" href="{% static 'styles.css' %}">
{% endblock %}
{% block title %}Danh sách người dùng{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">Danh sách người dùng</h1>
    
    <div class="search-add-container">
        <div class="search-container">
            <form method="GET" action="{% url 'user_list' %}">
                <input type="text" name="search" placeholder="Nhập tên người dùng cần tìm kiếm" class="search-input" value="{{ search_query }}">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </form>
        </div>
        <a href="{% url 'user_create' %}" class="btn btn-primary">Thêm</a>
    </div>
    
    <div class="table-container">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Họ và tên</th>
                    <th>Vai trò</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ user.first_name }} {{ user.last_name }}</td>
                    <td>
                        {% if user.account.role == 'student' %}
                            <span class="role role-student">Học viên</span>
                        {% elif user.account.role == 'teacher' %}
                            <span class="role role-teacher">Giáo viên</span>
                        {% else %}
                            <span class="role role-user">Admin</span>
                        {% endif %}
                    </td>
                    <td class="actions">
                        <div class="dropdown">
                            <button class="dropdown-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="12" cy="5" r="1"></circle>
                                    <circle cx="12" cy="19" r="1"></circle>
                                </svg>
                            </button>
                            <div class="dropdown-content">
                                <a href="{% url 'user_detail' user.user_id %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Xem
                                </a>
                                <a href="{% url 'user_edit' user.user_id %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                    Sửa
                                </a>
                                <a href="#" class="delete-action" data-user-id="{{ user.user_id }}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                    </svg>
                                    Xóa
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">Không có người dùng nào</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Form ẩn để xóa người dùng -->
<form id="delete-form" method="POST" style="display: none;">
    {% csrf_token %}
</form>

<script>
    // Dropdown functionality
    document.addEventListener('click', function(e) {
        const dropdowns = document.querySelectorAll('.dropdown-content');
        if (!e.target.matches('.dropdown-btn') && !e.target.closest('.dropdown-btn')) {
            dropdowns.forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        } else {
            const dropdown = e.target.closest('.dropdown').querySelector('.dropdown-content');
            dropdowns.forEach(d => {
                if (d !== dropdown) d.classList.remove('show');
            });
            dropdown.classList.toggle('show');
        }
    });

    // Delete action
    document.querySelectorAll('.delete-action').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const userId = this.getAttribute('data-user-id');
            if (confirm('Bạn có chắc chắn muốn xóa người dùng này?')) {
                const form = document.getElementById('delete-form');
                form.action = `/users/${userId}/delete/`;
                form.submit();
            }
        });
    });
</script>
{% endblock %}

